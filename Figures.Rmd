---
title: "Figures"
output: html_document
editor_options: 
  chunk_output_type: console
---

# Library load
```{r library}

library(dplyr)# data manipulation
library(ggplot2) # plotting
library(ape) # phylogenetics package
library(phytools)# phylogenetics package

# following this map tutorial
#https://www.r-spatial.org/r/2018/10/25/ggplot2-sf.html
#install.packages(c("cowplot", "googleway", "ggrepel", "ggspatial", "libwgeom", "sf", "rnaturalearth", "rnaturalearthdata"))
library(rnaturalearth)
library(rnaturalearthdata)
theme_set(theme_bw())
library(sf)
library(rgeos)
world <- ne_countries(scale = "medium", returnclass = "sf")
class(world)
library(ggspatial)
library(geiger)
#if (!requireNamespace("BiocManager", quietly = TRUE)) install.packages("BiocManager")
#BiocManager::install("ggtree")
library(ggtree)
```

# load data

```{r}
# load tree
tr<-read.tree("RAxML_bipartitions_Pocc-out.nwk")



## load the map
dat<-read.csv("Table_S1.csv")
range(dat$Lat.N)
range(dat$Long.W)
# get unique coords - for map
dat.un<-dat%>%
  group_by(Map_type,Map_colour,abbrev)%>%
  dplyr::summarise(lat=mean(Lat.N),lon=mean(Long.W))

dat.un$Map_type<-factor(dat.un$Map_type,levels=c("P. rugosus","FGH","J","P. barbatus","P. occidentalis","P. desertorum"))



```

## phylogeny plot

```{r}
###using ape and phytools
# no branch lengths
tr1<-tr
tr1$edge.length<-NULL

tr1<-rotateNodes(tr1, nodes=c(42,60,61,67,44,45,54))
plotTree(tr1,direction="downwards")
nodelabels()
edgelabels()



# to color edges -https://ecomorph.wordpress.com/2014/10/09/phylogenetic-trees-in-r-4/
### get branch info based on tip info we just extracted
prugB<-c(5,6,7,8,9,10,11,18,19,20,37,38,39)
JlinB<-c(12,13,14,15,16,43,44,45)
fghB<-c(seq(21,35,1),seq(46,58,1))
pbarbB<-c(seq(59,65,1),seq(66,76,1))
### now we get to add the color
clcolr <- rep("darkgrey", dim(tr1$edge)[1]) ## background color
clcolr[JlinB] <- "goldenrod"
clcolr[fghB] <- "violet"
clcolr[pbarbB] <- "blue"
clcolr[prugB] <- "red"

### replotting with color
plot(tr1,direction="downwards",edge.color=clcolr,edge.width=3)
#nodelabels(text=tr1$node.label)

###using ggtree
#ggtree(tr1)+geom_text()


```

## plot map

```{r}
ggplot(data = world) +
geom_sf(fill= "white")+borders("state")+theme(panel.grid.major = element_line(color = gray(.5), linetype = "dashed", size = 0.5), panel.background = element_rect(fill = "aliceblue"))+
coord_sf(xlim = c(-120,-90), ylim = c(23,37), expand = FALSE)+borders("state")+
  geom_point(data=dat.un,aes(x=lon,y=lat,colour=factor(Map_type)),size=2)+scale_color_manual(values=c("red","violet","goldenrod","blue","grey","black"),name="Species/Lineage")+xlab("Longitude")+ylab("Latitude")
#  geom_text(data=dat.un,aes(x=jitter(lon),y=jitter(lat),label=abbrev),size=3)





```


# Session info
```{r sessioninfo}

sessionInfo()


```